---
show: step

version: 1.0
enable_checker: true
---

# 换行回车

## 回忆上次内容

- 用`\r`可以让输出位置回到最开头的地方
- 重新输入
- 我们可以让时间在固定位置刷新了
- 但是
	- `\n` - LF - LineFeed - 换行
	- `\r` - CR - CarriageReturn - 回车
- 这有什么区别吗？🤔

### 换行回车

- 说到这个呢，就不得不说起当时的终端形态
- 电传打字机`TTY` 全称 `T`ele`TY`pewriter
	- tele的意思是远程的，电报望远镜电视机有这个词根
	- type是打字
	- writer是打字机
	- 合在一起就是电传打字机
- 早年间他以电报的方式存在
	- 后来股票电报机大规模应用
	- 大西洋下面铺设了海底光缆
	- 具体可以看 《oeasy教你玩转电磁波》
- 大量tty相连接，构成了当时传播信息的tty网络
- 当时没有路由器，每个人都是消息的发送、接收、转发者
- 早年间电脑不能和tty相连接
- 直到1959年 DEC 公司生产的 PDP－1 电脑，用了纸带 TTY
- 后来tty有了专门的纸张
- 他既是键盘，又是显示器(以打字机的形态存在)

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210221-1613914040719)

- 最早的计算机(如eniac)不能和tty相连
- 后来可通过串口线和电脑连接
- 很多终端远程登录的时候用的名称也是`tty`之类的东西 
- 但是通信线路变成了网线
	- 基于tcp/ip协议
	- 可以自动路由转发
- tty、terminal、shell、console好像都是终端
- 有什么不一样吗？

### 区分几个概念

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210221-1613916532296)

- terminal终端
	- 电脑连线结束的断电
	- 一般是一个tty之类的东西
	- 当时的大流行设备是Teletype Model 33
	- Xterm就是一个X Window terminal
	- terminal上面运行着shell
- shell
	- 终端硬件基础上的软件壳子
	- 可以有不同的壳子ksh、csh、bash等
	- 一套壳子就是一套命令解释系统
		- 比如把ls解释为当前文件夹文件列表
		- 可以管理前台和后台程序运行
	- 方便终端上的tty和电脑主机交互
	- SSH 为 Secure Shell 
- Console 控制台
	- 可以理解为控制面板
	- 从底层监控操作系统
		- 有显示寄存器状态的指示灯
		- 有直接操作寄存器的开关
	- 而且它与电脑主机紧密结合
	- 无法远程操作
- TTY TeleTYpewriter 电传打印机
	- 位于终端的原始电脑连接硬件
	- 接收电脑发送过来的字节
	- 发送字节给电脑

### `\r`对应的ascii码

- 早年间要回车需要传过来一个`\n`这样的字符
	- 对应的字节为`0x0A`
	- 目标是新启一行
	- 理论上的`\n`应该是这样的
- 那么`\r`这样的字符，对应字节是多少呢？是干什么用的呢

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210221-1613917872385)

- 也就是说`\r`是`1`个字符
- `\r`对应的二进制字符是`0x0d`


### 电传打字机的理解
![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210221-1613914040719)

- 作为电传打字机来说，
- 换行和回车是两回事
	- 换行 对应字节`0x0A` Line-Feed 的意思是水平不动、垂直向上喂纸 所以是`feed`
	- 回车 对应字节`0x0D` Carriage-Return 的意思是让上图可移动的打印头(好像可移动的四轮马车Carriage)垂直不动、水平 `回`到纸张左侧 所以是`Return`
- 当CR和LF组合使用时，则会将打印纸张上移一行，且下一个打字位置将回到该行的最左侧，也就是我们今天所理解的换行操作。


![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210222-1613961902716)	

### 不同操作系统的理解

- 机械打字机渐渐地退出了历史舞台
	- 当初的纸张变成了今天的显示器
	- 打字机的按键也演变为了如今的键盘
- 操作系统Unix出现
	- 受限于内存和软盘空间的不足
	- 设计者决定采用单个字符来表示换行符
	- 使`\n`单字符替代`\r\n`，默认`\n`=`\r\n`
	- C语言在编程的时候继续了这个惯例
	- 他既干了换行的活`\n`，又干了回车的活`\r`
	- Unix-Like都是如此，包括BSD、Linux

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210222-1613974579679)

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210222-1613974568636)

- 可是实际上是这样的

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210222-1613974622383)

- 一度很流行的Commodore64
	- 使用`\r`代替`\r\n`
- MacOs
	- 早期也是使用`\r`代替`\r\n`
	- 甚至按键都叫做<kbd>return</kbd>
	- 后来和unix保持一致`\n`
	- 我想原因可能是Mac开发者也曾用ssh连接unix-like的服务器
	- 总而言之，现在流行的三大系统两个都是`\n`
	- 下面就看微软的表现了
- 微软
	- DOS系统是兼容人家CP/M形成的
	- CP/M使用`\r\n`
	- 键盘上印的名称是<kbd>enter↵</kbd>符号能看出就是`\r\n`
	- 后来的windows顺着DOS的惯例
	- 这会使跨系统浏览文档的时候
		- 有的时候会所有东西变成一行
		- 有的会出现'0D', '^M'之类的乱码
	- 不只是windows记事本的解释方式
	- 而且微软系列的office等，都有这个困扰
	- win10最新的记事本🗒️，已经针对这个做了优化
	- 其他的微软产品估计也会陆续跟进


### python解释器的理解

- python的显示靠的是终端屏幕
- python的输入靠的是终端键盘
- `\n` 显示的时候就会换行 LF
- `\r` 显示的时候就会退回到本行开头 CR
- 录入`\n`的时候就会以`0x0A`这样一个字节的形式存储在字符串中
- 录入`\r`的时候就会以`0x0D`这样一个字节的形式存储在字符串中
- 这样的编码来自于ascii编码
- python3解释器基于操作系统，操作系统基于cpu架构
- 不管什么样的操作系统、cpu架构，只要是python解释器，对于`\n`、`\r`的理解是统一的，是跨平台的(跨系统、跨架构的)。




## 总结

- 区分概念
	- terminal终端，电脑连线结束的端点
	- shell，终端硬件基础上的软件壳子
	- Console 控制台，直接连接主机的控制面板
	- TeleTYpewriter，电传打印机
- 换行和回车是两回事
	- 换行 对应字节`0x0A` Line-Feed 的意思是水平不动、垂直向上喂纸 所以是`feed`
	- 回车 对应字节`0x0D` Carriage-Return 的意思是让上图可移动的打印头(好像可移动的四轮马车Carriage)垂直不动、水平 `回`到纸张左侧 所以是`Return`
- 对于换行和回车，不同层面的理解
	- 电传打字机:两件事，经常一起干，但也可以分别干
	- 不同操作系统
		- unix-like：大家一起改造这个，就步调一致就都好了
		- windows：原来我用户多，定什么规矩我说了算,现在我还是随大流吧
	- python解释器
		- 不管在什么系统、什么架构上
		- 我把这个事统一
		- 我觉得unix-like做得对
- 光说不练假把式，我能看看电传打字机吗？🤔
- 我们下次再说！👋